# ğŸ›’ E-commerce Real-time Data Platform

### BigQuery/GCP ê¸°ë°˜ í’€ìŠ¤íƒ ë°ì´í„° í”Œë«í¼ â€” ì‹¤ì‹œê°„ íŒŒì´í”„ë¼ì¸ë¶€í„° AI í’ˆì§ˆ ê´€ë¦¬ê¹Œì§€

> **"ì´ì»¤ë¨¸ìŠ¤ í™˜ê²½ì—ì„œ ë°œìƒí•˜ëŠ” í•˜ë£¨ 280ë§Œ ê±´ì˜ ì‚¬ìš©ì í–‰ë™ ë°ì´í„°ë¥¼, ì‹¤ì‹œê°„ìœ¼ë¡œ ìˆ˜ì§‘í•˜ê³  ë¶„ì„ ê°€ëŠ¥í•œ ìƒíƒœë¡œ ì „ë‹¬í•˜ëŠ” í”Œë«í¼ì„ ì„¤ê³„Â·êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤."**

[![Python 3.11+](https://img.shields.io/badge/python-3.11+-blue.svg)](https://python.org)
[![GCP](https://img.shields.io/badge/cloud-GCP-4285F4.svg)](https://cloud.google.com)
[![Kubernetes](https://img.shields.io/badge/orchestration-Kubernetes-326CE5.svg)](https://kubernetes.io)
[![Terraform](https://img.shields.io/badge/IaC-Terraform-7B42BC.svg)](https://terraform.io)
[![BigQuery](https://img.shields.io/badge/DW-BigQuery-669DF6.svg)](https://cloud.google.com/bigquery)
[![GenAI](https://img.shields.io/badge/AI-Gemini%202.0-FF6F00.svg)](https://ai.google.dev)

---

## ğŸ“Œ í•œëˆˆì— ë³´ê¸° (Key Highlights)

| ì§€í‘œ | ìˆ˜ì¹˜ |
|:-----|:-----|
| **ì¼ì¼ ì²˜ë¦¬ ì´ë²¤íŠ¸** | ~2.84M events/day |
| **ë°ì´í„° ì§€ì—° (SLA)** | í‰ê·  4.2ë¶„ (ëª©í‘œ: 30ë¶„ ì´ë‚´) |
| **íŒŒì´í”„ë¼ì¸ ì„±ê³µë¥ ** | 99.7% |
| **BigQuery ë¹„ìš© ì ˆê°** | Gemini SQL ìµœì í™”ë¡œ **31% ê°ì¶•** ($19.1 â†’ $12.4/ì¼) |
| **ì¸í”„ë¼ ë¹„ìš© ì ˆê°** | Spot Instance ë„ì…ìœ¼ë¡œ Pipeline ë…¸ë“œ **ìµœëŒ€ 60% ì ˆê°** |
| **ì˜¤í† ìŠ¤ì¼€ì¼ë§** | 2 â†’ 10 Pods (í”¼í¬ íŠ¸ë˜í”½ ëŒ€ì‘, HPA ê¸°ë°˜) |

---

## ğŸ“Š Live Dashboard Preview

> ì•„ë˜ëŠ” ì‹¤ì œ Prometheus + Grafana ê¸°ë°˜ ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œì…ë‹ˆë‹¤.

### ì „ì²´ ëŒ€ì‹œë³´ë“œ â€” Pipeline Performance & Business Metrics
![Dashboard Overview](docs/dashboards/screenshots/dashboard-overview.png)

**ì£¼ìš” íŒ¨ë„ ì„¤ëª…:**
- **Events Throughput**: ì‹œê°„ëŒ€ë³„ ì´ë²¤íŠ¸ ìˆ˜ì§‘ëŸ‰ (í”¼í¬ ì‹œê°„ ~1,180 RPS)
- **Data Quality Checks**: 6ê°€ì§€ ìë™í™” í’ˆì§ˆ ì²´í¬ (Freshness, Volume Z-Score, Null Rate, Duplicate Rate)
- **Conversion Funnel**: 7ì¼ê°„ êµ¬ë§¤ ì „í™˜ í¼ë„ (Page View â†’ Purchase, CVR 12.0%)
- **GenAI Quality Report**: Geminiê°€ ìƒì„±í•œ ì´ìƒ ì§•í›„ ë¶„ì„ ë¦¬í¬íŠ¸

### AI Quality Agent & Cost Optimization
![AI Dashboard](docs/dashboards/screenshots/dashboard-ai-cost.png)

**ì£¼ìš” íŒ¨ë„ ì„¤ëª…:**
- **Pipeline Status**: 5ê°œ íŒŒì´í”„ë¼ì¸ ì‹¤ì‹œê°„ ìƒíƒœ (Event Collector, CDC, Batch ETL, Beam, Quality Agent)
- **BigQuery Cost Trend**: SQL ìµœì í™” ì „/í›„ ë¹„ìš© ë¹„êµ (31% ê°ì¶• ì‹œê°í™”)
- **HPA Auto-Scaling**: íŠ¸ë˜í”½ì— ë”°ë¥¸ Pod ìˆ˜ ìë™ ì¡°ì ˆ (ìƒˆë²½ 2 â†’ í”¼í¬ 9 replicas)
- **CDC Replication Lag**: PostgreSQL â†’ BigQuery ë³µì œ ì§€ì—° (í‰ê·  2.8ì´ˆ, SLA 10ì´ˆ ì´ë‚´)

---

## ğŸ—ï¸ 1. Cloud-Native Data Architecture (í•µì‹¬ ì—­ëŸ‰)

### Why this architecture?

ë‹¨ìˆœíˆ ê¸°ìˆ ì„ ë‚˜ì—´í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **ê° ì„ íƒì˜ ê·¼ê±°(Rationale)**ì— ì´ˆì ì„ ë§ì·„ìŠµë‹ˆë‹¤.

### GCP ê¸°ë°˜ 3-Layer ë°ì´í„° ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                          â”‚
â”‚   ğŸ“± Mobile/Web          ğŸ—„ï¸ PostgreSQL                                   â”‚
â”‚      Clients              (Source DB)                                    â”‚
â”‚         â”‚                     â”‚                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚    â”‚ Event Collectorâ”‚    â”‚  Debezium  â”‚                                   â”‚
â”‚    â”‚   (FastAPI)    â”‚    â”‚    CDC     â”‚                                   â”‚
â”‚    â”‚  + K8s HPA     â”‚    â”‚           â”‚                                   â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚         â”‚                     â”‚                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                                     â”‚
â”‚    â”‚      Google Cloud Pub/Sub      â”‚  Message Queue (ë¹„ë™ê¸° ë²„í¼)        â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                     â”‚
â”‚         â”‚                     â”‚                                          â”‚
â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”                                  â”‚
â”‚    â”‚   Beam/   â”‚    â”‚  CDC Pipeline   â”‚                                  â”‚
â”‚    â”‚ Dataflow  â”‚    â”‚  (Batch Insert) â”‚                                  â”‚
â”‚    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                  â”‚
â”‚         â”‚                     â”‚                                          â”‚
â”‚  â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â–¼â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  â•‘                                                                   â•‘   â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘   â”‚
â”‚  â•‘  â”‚           ğŸŸ¦ BigQuery Raw Layer                             â”‚  â•‘   â”‚
â”‚  â•‘  â”‚   â€¢ Append-only (ê°ì‚¬ ì¶”ì  ê°€ëŠ¥)                            â”‚  â•‘   â”‚
â”‚  â•‘  â”‚   â€¢ DAY íŒŒí‹°ì…”ë‹ (event_timestamp)                         â”‚  â•‘   â”‚
â”‚  â•‘  â”‚   â€¢ í´ëŸ¬ìŠ¤í„°ë§ (event_type, device_type)                    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚   â€¢ 90ì¼ TTL ìë™ ë§Œë£Œ                                     â”‚  â•‘   â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘   â”‚
â”‚  â•‘                          â”‚ Airflow Daily Batch                    â•‘   â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘   â”‚
â”‚  â•‘  â”‚           ğŸŸ© BigQuery Staging Layer                         â”‚  â•‘   â”‚
â”‚  â•‘  â”‚   â€¢ ì¤‘ë³µ ì œê±° (CTAS + ROW_NUMBER)                          â”‚  â•‘   â”‚
â”‚  â•‘  â”‚   â€¢ ë°ì´í„° íƒ€ì… ì •ê·œí™”                                      â”‚  â•‘   â”‚
â”‚  â•‘  â”‚   â€¢ í’ˆì§ˆ ê²€ì¦ ì™„ë£Œ ë°ì´í„°                                   â”‚  â•‘   â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘   â”‚
â”‚  â•‘                          â”‚                                        â•‘   â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘   â”‚
â”‚  â•‘  â”‚           ğŸŸ¨ BigQuery Mart Layer                            â”‚  â•‘   â”‚
â”‚  â•‘  â”‚   â€¢ ì‚¬ìš©ì í–‰ë™ ë¶„ì„ (DAU, ë¦¬í…ì…˜ ì½”í˜¸íŠ¸)                   â”‚  â•‘   â”‚
â”‚  â•‘  â”‚   â€¢ ì „í™˜ í¼ë„ (Page View â†’ Purchase)                       â”‚  â•‘   â”‚
â”‚  â•‘  â”‚   â€¢ ìƒí’ˆ ì„±ê³¼ ë¶„ì„ (ë§¤ì¶œ, ì¡°íšŒìˆ˜, ì „í™˜ìœ¨)                   â”‚  â•‘   â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘   â”‚
â”‚  â•‘                        BigQuery                                   â•‘   â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ ğŸ¤– GenAI Agent  â”‚  â”‚ ğŸ“Š Prometheus +  â”‚  â”‚ ğŸ”§ Terraform IaC â”‚      â”‚
â”‚  â”‚ (Gemini+LangChain) â”‚ Grafana          â”‚  â”‚ (ì¬í˜„ ê°€ëŠ¥í•œ ì¸í”„ë¼) â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                 GKE (Kubernetes Cluster)                          â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì™œ ì´ ê¸°ìˆ ë“¤ì„ ì„ íƒí–ˆëŠ”ê°€ (Rationale)

#### BigQuery â€” "ì„œë²„ë¦¬ìŠ¤ DWë¡œ ìš´ì˜ ë¶€ë‹´ì„ ìµœì†Œí™”"

| ê²°ì • | ëŒ€ì•ˆ ê²€í†  | ì±„íƒ ì´ìœ  |
|:-----|:---------|:---------|
| **Streaming Insert** | Storage Write API | ì†Œê·œëª¨ íŠ¸ë˜í”½ì—ì„œ êµ¬í˜„ ë³µì¡ë„ â†“, ë¹„ìš© íš¨ìœ¨ì . Storage Write APIëŠ” ì¼ 1,000ë§Œ ê±´ ì´ìƒì¼ ë•Œ ì „í™˜ ê³ ë ¤ |
| **Daily CTAS** (Staging) | Incremental MERGE | êµ¬í˜„ ë‹¨ìˆœì„± + ë°ì´í„° ì •í•©ì„± 100% ë³´ì¥. MERGEëŠ” CDC íŠ¹ì„±ìƒ ìˆœì„œ ë³´ì¥ ì´ìŠˆ ì¡´ì¬ |
| **DAY íŒŒí‹°ì…”ë‹** | HOUR / MONTH | ì¼ë³„ ë°°ì¹˜ ETL ì£¼ê¸°ì™€ ì¼ì¹˜. ì¿¼ë¦¬ ì‹œ íŒŒí‹°ì…˜ í”„ë£¨ë‹ìœ¼ë¡œ ë¹„ìš© ìµœì í™” |
| **event_type í´ëŸ¬ìŠ¤í„°ë§** | user_id í´ëŸ¬ìŠ¤í„°ë§ | ë¶„ì„ ì¿¼ë¦¬ 80%ê°€ ì´ë²¤íŠ¸ íƒ€ì… í•„í„°ë§. í´ëŸ¬ìŠ¤í„°ë§ìœ¼ë¡œ ìŠ¤ìº” ë¹„ìš© ì¶”ê°€ ì ˆê° |

> **ğŸ’¡ ê¹¨ë‹¬ì€ ì **: BigQueryëŠ” "ìŠ¤ìº”í•œ ë°ì´í„°ì–‘ = ë¹„ìš©"ì´ê¸° ë•Œë¬¸ì—, íŒŒí‹°ì…”ë‹/í´ëŸ¬ìŠ¤í„°ë§ ì „ëµì´ ê³§ ë¹„ìš© ì „ëµì…ë‹ˆë‹¤. `SELECT *` í•œ ë²ˆì˜ ì‹¤ìˆ˜ê°€ ì˜ˆìƒ ë¹„ìš©ì˜ 10ë°°ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆì–´, SQL Optimizerë¥¼ GenAIë¡œ ìë™í™”í•œ ë°°ê²½ì´ê¸°ë„ í•©ë‹ˆë‹¤.

#### Pub/Sub â€” "Kafka ëŒ€ì‹  GCP ë„¤ì´í‹°ë¸Œ í†µí•©ì„ íƒí•œ ì´ìœ "

```
âŒ Kafka ì§ì ‘ ì—°ë™          vs          âœ… Pub/Sub ì±„íƒ
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â€¢ Zookeeper/Broker ìš´ì˜ í•„ìš”           â€¢ ì™„ì „ ê´€ë¦¬í˜• (serverless)
â€¢ GKE ë‚´ ë¦¬ì†ŒìŠ¤ ì ìœ  í¼               â€¢ GCP IAM/ëª¨ë‹ˆí„°ë§ ë„¤ì´í‹°ë¸Œ í†µí•©
â€¢ íŒŒí‹°ì…˜ ê´€ë¦¬ í•„ìš”                    â€¢ ìë™ ìŠ¤ì¼€ì¼ë§
â€¢ Debezium â†’ KafkaëŠ” ìœ ì§€            â€¢ Kafka â†’ Pub/Sub ë¸Œë¦¿ì§€ë¡œ ì—°ê²°
```

> **íŠ¸ë ˆì´ë“œì˜¤í”„**: Kafkaì˜ ìˆœì„œ ë³´ì¥ê³¼ consumer group ê¸°ëŠ¥ì„ í¬ê¸°í•˜ëŠ” ëŒ€ì‹ , ìš´ì˜ ë¶€ë‹´ ìµœì†Œí™”ë¥¼ ì„ íƒ. CDC íŒŒì´í”„ë¼ì¸ì—ì„œ idempotent write(PK + timestamp ê¸°ë°˜ ì¤‘ë³µ ì œê±°)ë¡œ ìˆœì„œ ë¹„ë³´ì¥ ë¬¸ì œë¥¼ ë³´ì™„í–ˆìŠµë‹ˆë‹¤.

#### Terraform IaC â€” "ì¸í”„ë¼ì˜ ì¬í˜„ì„±(Reproducibility)"

```hcl
# terraform/bigquery.tf â€” 3-Layer ì•„í‚¤í…ì²˜ë¥¼ ì½”ë“œë¡œ ì •ì˜
resource "google_bigquery_dataset" "raw" {
  dataset_id    = "raw"
  description   = "Append-only raw data from CDC and event pipelines"
  location      = "asia-northeast3"
  default_table_expiration_ms = 7776000000  # 90ì¼ TTL
}

resource "google_bigquery_table" "user_events" {
  time_partitioning { type = "DAY"; field = "event_timestamp" }
  clustering = ["event_type", "device_type"]
  # ... 15ê°œ ì»¬ëŸ¼ ìŠ¤í‚¤ë§ˆ ì •ì˜
}
```

**Terraformìœ¼ë¡œ ê´€ë¦¬í•˜ëŠ” GCP ë¦¬ì†ŒìŠ¤ (8ì¢…):**
- BigQuery: 4 datasets (raw, staging, mart, monitoring) + 2 tables
- Pub/Sub: 3 topics + 3 subscriptions (DLQ í¬í•¨)
- GKE: 1 cluster + 2 node pools + VPC/Subnet/NAT
- IAM: 3 service accounts + Workload Identity binding

### ì‹¤ì‹œê°„ vs ë°°ì¹˜ í•˜ì´ë¸Œë¦¬ë“œ íŒŒì´í”„ë¼ì¸

ì´ì»¤ë¨¸ìŠ¤ ë°ì´í„°ëŠ” **ì‹¤ì‹œê°„ ë°˜ì˜ì´ í•„ìš”í•œ ë°ì´í„°**(ì£¼ë¬¸ ìƒíƒœ)ì™€ **ì¼ê´„ ë¶„ì„ì´ ì í•©í•œ ë°ì´í„°**(ì‚¬ìš©ì í–‰ë™)ê°€ ê³µì¡´í•©ë‹ˆë‹¤.

```
â”Œâ”€ ì‹¤ì‹œê°„ ê²½ë¡œ (Latency: ~5ì´ˆ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL â†’ Debezium CDC â†’ Kafka â†’ CDC Pipeline â†’ BigQuery  â”‚
â”‚  â€¢ ì£¼ë¬¸/ì¬ê³ /ë°°ì†¡ ìƒíƒœ ë³€ê²½                                    â”‚
â”‚  â€¢ 5ì´ˆ ê°„ê²© ë°°ì¹˜ flush (100ê±´ ë˜ëŠ” 5ì´ˆ ì¤‘ ë¨¼ì € ì¶©ì¡±)           â”‚
â”‚  â€¢ Dead Letter Queueë¡œ ì‹¤íŒ¨ ì´ë²¤íŠ¸ ê²©ë¦¬                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ì¤€ì‹¤ì‹œê°„ ê²½ë¡œ (Latency: ~ë¶„) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Client â†’ Event Collector â†’ Pub/Sub â†’ Beam/Dataflow â†’ BigQuery â”‚
â”‚  â€¢ ì‚¬ìš©ì í–‰ë™ ë¡œê·¸ (page_view, add_to_cart, purchase ë“±)      â”‚
â”‚  â€¢ Beam ìœˆë„ì‰ìœ¼ë¡œ ë§ˆì´í¬ë¡œ ë°°ì¹˜ ì²˜ë¦¬                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€ ë°°ì¹˜ ê²½ë¡œ (Daily 03:00 KST) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BigQuery Raw â†’ Staging â†’ Mart (Airflow KubernetesExecutor)    â”‚
â”‚  â€¢ ì¤‘ë³µ ì œê±° (ROW_NUMBER + CTAS)                              â”‚
â”‚  â€¢ ë¹„ì¦ˆë‹ˆìŠ¤ ì§‘ê³„ í…Œì´ë¸” ìƒì„± (DAU, í¼ë„, ë§¤ì¶œ)                â”‚
â”‚  â€¢ í‰ê·  ì‹¤í–‰ ì‹œê°„: 8ë¶„ 24ì´ˆ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¡ 2. Scalable Infrastructure & Orchestration (K8s/DevOps)

> **í•µì‹¬ í‚¤ì›Œë“œ: ì•ˆì •ì„±(Reliability) Ã— í™•ì¥ì„±(Scalability) Ã— ë¹„ìš© íš¨ìœ¨(Cost-efficiency)**

### GKE í´ëŸ¬ìŠ¤í„° ì„¤ê³„ ì „ëµ

```
GKE Cluster: data-platform-dev
â”œâ”€â”€ ğŸŸ¢ General Pool (Always-On)
â”‚   â”œâ”€â”€ Machine: e2-standard-2 (auto-scaling 1~6)
â”‚   â”œâ”€â”€ ì—­í• : Event Collector, Airflow, Monitoring
â”‚   â””â”€â”€ ë¹„ìš©: On-demand (ì•ˆì •ì„± ìš°ì„ )
â”‚
â”œâ”€â”€ ğŸŸ¡ Pipeline Pool (Cost-Optimized)
â”‚   â”œâ”€â”€ Machine: e2-standard-4 (auto-scaling 0~5)
â”‚   â”œâ”€â”€ ì—­í• : Batch ETL, Beam workers
â”‚   â”œâ”€â”€ Spot Instance â† ìµœëŒ€ 60% ë¹„ìš© ì ˆê°
â”‚   â””â”€â”€ Taint: pipeline ì›Œí¬ë¡œë“œë§Œ ìŠ¤ì¼€ì¤„ë§
â”‚
â””â”€â”€ ğŸ”’ Network: Private Cluster
    â”œâ”€â”€ ë…¸ë“œ í¼ë¸”ë¦­ IP ì—†ìŒ (ë³´ì•ˆ)
    â”œâ”€â”€ Cloud NATë¡œ ì™¸ë¶€ í†µì‹ 
    â””â”€â”€ Workload Identity (SA í‚¤ íŒŒì¼ ì œê±°)
```

#### ì™œ ë‘ ê°œì˜ Node Poolì„ ë¶„ë¦¬í–ˆëŠ”ê°€?

```
ë¹„ìš© ì‹œë‚˜ë¦¬ì˜¤ ë¶„ì„:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ë‹¨ì¼ Pool (On-demand only):
  General: e2-standard-4 Ã— 4ëŒ€ = ~$391/ì›”
  
ë¶„ë¦¬ Pool (General + Spot):
  General: e2-standard-2 Ã— 2ëŒ€ = ~$98/ì›”
  Pipeline: e2-standard-4 Ã— 2ëŒ€ (Spot) = ~$60/ì›”
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ì ˆê°: $391 â†’ $158 (ì•½ 60% ì ˆê°)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

> **Spot Instanceì˜ ë¦¬ìŠ¤í¬**: Spotì€ ì–¸ì œë“  íšŒìˆ˜ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°°ì¹˜ íŒŒì´í”„ë¼ì¸ì€ ì‹¤íŒ¨ ì‹œ Airflowê°€ ìë™ ì¬ì‹œë„(retries=2)í•˜ë¯€ë¡œ, Spot íšŒìˆ˜ì— ì˜í•œ ì¼ì‹œì  ì‹¤íŒ¨ë¥¼ í—ˆìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë°˜ë©´ Event CollectorëŠ” ì‚¬ìš©ì ìš”ì²­ì„ ì§ì ‘ ì²˜ë¦¬í•˜ë¯€ë¡œ On-demand Poolì— ë°°ì¹˜í–ˆìŠµë‹ˆë‹¤.

### Kubernetes ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜ ìƒì„¸

#### Event Collector â€” HPA ê¸°ë°˜ íŠ¸ë˜í”½ ëŒ€ì‘

```yaml
# ì™œ HPAê°€ í•„ìš”í•œê°€:
# ì´ì»¤ë¨¸ìŠ¤ íŠ¸ë˜í”½ì€ ì‹œê°„ëŒ€ë³„ í¸ì°¨ê°€ ê·¹ì‹¬í•©ë‹ˆë‹¤.
# ìƒˆë²½ 68 RPS â†’ ì ì‹¬ 1,180 RPS (17ë°° ì°¨ì´)
# ê³ ì • Pod ìˆ˜ë¡œëŠ” ë¹„íš¨ìœ¨ì ì´ê±°ë‚˜ ì¥ì• ê°€ ë°œìƒí•©ë‹ˆë‹¤.

spec:
  minReplicas: 2       # ìµœì†Œ ê°€ìš©ì„± ë³´ì¥ (ìƒˆë²½ ì‹œê°„ëŒ€)
  maxReplicas: 10      # í”¼í¬ íŠ¸ë˜í”½ ëŒ€ì‘
  metrics:
    - resource:
        name: cpu
        target: { averageUtilization: 70 }   # CPU ê¸°ë°˜
    - pods:
        metric: { name: http_requests_per_second }
        target: { averageValue: "1000" }       # RPS ê¸°ë°˜ (ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­)
  behavior:
    scaleUp:
      stabilizationWindowSeconds: 60     # 1ë¶„ê°„ ì•ˆì •í™” í›„ ìŠ¤ì¼€ì¼ì—…
      policies:
        - type: Pods
          value: 2                       # í•œ ë²ˆì— ìµœëŒ€ 2ê°œ Pod ì¶”ê°€
          periodSeconds: 60
    scaleDown:
      stabilizationWindowSeconds: 300    # 5ë¶„ê°„ ì•ˆì •í™” í›„ ìŠ¤ì¼€ì¼ë‹¤ìš´ (ê¸‰ê²©í•œ ì¶•ì†Œ ë°©ì§€)
```

![HPA Scaling](docs/dashboards/screenshots/dashboard-hpa-scaling.png)
*â–² ì‹œê°„ëŒ€ë³„ íŠ¸ë˜í”½ì— ë”°ë¥¸ ìë™ Pod ìŠ¤ì¼€ì¼ë§ (ìƒˆë²½ 2 â†’ í”¼í¬ 9 replicas)*

#### CDC Pipeline â€” ì•ˆì •ì„± ìµœìš°ì„  ì„¤ê³„

```yaml
# ì™œ replicas: 1ì¸ê°€?
# CDCëŠ” PostgreSQL WALì„ ìˆœì°¨ ì²˜ë¦¬í•©ë‹ˆë‹¤.
# ë³µìˆ˜ replicaê°€ ë™ì¼ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í•˜ë©´ ì¤‘ë³µ ì ì¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.
# ëŒ€ì‹  ì•ˆì •ì„±ì„ ë³´ì¥í•˜ê¸° ìœ„í•œ ë””í…Œì¼ì„ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤.

spec:
  replicas: 1
  template:
    spec:
      terminationGracePeriodSeconds: 60    # ë²„í¼ flush ëŒ€ê¸° (ë°ì´í„° ìœ ì‹¤ ë°©ì§€)
      containers:
        - lifecycle:
            preStop:
              exec:
                command: ["kill", "-SIGTERM", "1"]  # Graceful shutdown
          resources:
            requests: { cpu: "500m", memory: "1Gi" }
            limits:   { cpu: "2000m", memory: "2Gi" }  # Burstable QoS
---
# ë…¸ë“œ ìœ ì§€ë³´ìˆ˜ ì‹œì—ë„ Podë¥¼ ì¦‰ì‹œ ì¢…ë£Œí•˜ì§€ ì•ŠìŒ
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: cdc-pipeline-pdb
spec:
  minAvailable: 0    # ë‹¨ì¼ replicaì´ë¯€ë¡œ ìœ ì§€ë³´ìˆ˜ ì‹œ ì¼ì‹œ ì¤‘ë‹¨ í—ˆìš©
```

#### Zero-Downtime ìš´ì˜ì„ ìœ„í•œ ë””í…Œì¼

| ì„¤ì • | ì ìš© ëŒ€ìƒ | ëª©ì  |
|:-----|:---------|:-----|
| `podAntiAffinity` | Event Collector | Podë¥¼ ì„œë¡œ ë‹¤ë¥¸ ë…¸ë“œì— ë¶„ì‚° â†’ ë‹¨ì¼ ë…¸ë“œ ì¥ì•  ì‹œì—ë„ ì„œë¹„ìŠ¤ ìœ ì§€ |
| `terminationGracePeriodSeconds: 60` | CDC Pipeline | ì¢…ë£Œ ì‹œ ë©”ëª¨ë¦¬ ë²„í¼ì˜ ë¯¸ì „ì†¡ ë°ì´í„°ë¥¼ BigQueryì— flush |
| `PodDisruptionBudget` | CDC Pipeline | ë…¸ë“œ ë“œë ˆì¸ ì‹œ ìˆœì°¨ì  Pod êµì²´ë¡œ ë°ì´í„° ìœ ì‹¤ ë°©ì§€ |
| `readinessProbe` / `livenessProbe` | Event Collector | í—¬ìŠ¤ì²´í¬ ê¸°ë°˜ íŠ¸ë˜í”½ ë¼ìš°íŒ… (ì¤€ë¹„ë˜ì§€ ì•Šì€ Podì— ìš”ì²­ ì°¨ë‹¨) |
| Airflow `KubernetesExecutor` | Batch ETL | DAG íƒœìŠ¤í¬ë³„ ë…ë¦½ Pod ìƒì„±/ì‚­ì œ â†’ ë¦¬ì†ŒìŠ¤ ê²©ë¦¬ + ë¹„ìš© ìµœì í™” |

---

## ğŸ¤– 3. AI-Driven Data Governance (GenAI/AX)

> **ì´ í”„ë¡œì íŠ¸ì˜ ê°€ì¥ ê°•ë ¥í•œ ì°¨ë³„í™” í¬ì¸íŠ¸.**
> ë‹¨ìˆœí•œ ë°ì´í„° ì ì¬ë¥¼ ë„˜ì–´, "AIë¥¼ ì‹¤ë¬´ì— ë…¹ì—¬ ì‹¤ì§ˆì ì¸ ROIë¥¼ ì°½ì¶œ"í–ˆìŠµë‹ˆë‹¤.

### GenAI ë„êµ¬ í™œìš© ì „ëµ

| ë„êµ¬ | í™œìš© ì˜ì—­ | êµ¬ì²´ì  ì‚¬ë¡€ |
|:-----|:---------|:-----------|
| **GitHub Copilot** | ì½”ë“œ ìƒì„± | Pydantic ëª¨ë¸, BigQuery ìŠ¤í‚¤ë§ˆ, K8s ë§¤ë‹ˆí˜ìŠ¤íŠ¸ ìë™ ìƒì„± |
| **Claude** | ì„¤ê³„ ë¦¬ë·° | ì•„í‚¤í…ì²˜ íŠ¸ë ˆì´ë“œì˜¤í”„ ë¶„ì„, í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ |
| **Gemini 2.0 Flash** | ëŸ°íƒ€ì„ LLM | ë°ì´í„° í’ˆì§ˆ ë¶„ì„, SQL ìµœì í™”, ë¬¸ì„œ ìë™ ìƒì„± |

### 3-1. LLM ê¸°ë°˜ Data Quality Agent

> **"ì´ìƒ ì§•í›„ë¥¼ íƒì§€í•˜ê³ , ê·¼ë³¸ ì›ì¸ì„ ì¶”ë¡ í•˜ê³ , ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥ë„ê¹Œì§€ ë¶„ì„í•˜ëŠ” AI ì—ì´ì „íŠ¸"**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Data Quality Agent ë™ì‘ íë¦„                â”‚
â”‚                                                               â”‚
â”‚  â‘  Rule-Based Checks (SQL)                                   â”‚
â”‚     â”œâ”€â”€ Freshness: MAX(ingested_at)ê³¼ í˜„ì¬ ì‹œê° ì°¨ì´          â”‚
â”‚     â”œâ”€â”€ Volume: 14ì¼ ì´ë™í‰ê·  ëŒ€ë¹„ Z-Score (|z| > 2.0 â†’ FAIL)â”‚
â”‚     â”œâ”€â”€ Null Rate: í•µì‹¬ ì»¬ëŸ¼ null ë¹„ìœ¨ (> 5% â†’ FAIL)        â”‚
â”‚     â””â”€â”€ Duplicate: PK ê¸°ë°˜ ì¤‘ë³µë¥  (> 1% â†’ FAIL)             â”‚
â”‚                          â”‚                                    â”‚
â”‚  â‘¡ ì´ìƒ ì§•í›„ ë°œê²¬ ì‹œ â†’ Gemini LLM í˜¸ì¶œ                       â”‚
â”‚                          â”‚                                    â”‚
â”‚  â‘¢ AI Analysis                                               â”‚
â”‚     â”œâ”€â”€ ê·¼ë³¸ ì›ì¸ ì¶”ì • (í”„ë¡œëª¨ì…˜? ì‹œìŠ¤í…œ ì¥ì• ? ë°ì´í„° ì†ŒìŠ¤?)   â”‚
â”‚     â”œâ”€â”€ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥ë„ í‰ê°€ (ë§¤ì¶œ, ê³ ê° ê²½í—˜, ìš´ì˜)          â”‚
â”‚     â”œâ”€â”€ ì¦‰ì‹œ ì¡°ì¹˜ ì‚¬í•­ + ì¥ê¸° ê°œì„  ë°©ì•ˆ                       â”‚
â”‚     â””â”€â”€ Prometheus ë©”íŠ¸ë¦­ ì—°ë™ (ëŒ€ì‹œë³´ë“œ ë°˜ì˜)                â”‚
â”‚                          â”‚                                    â”‚
â”‚  â‘£ ê²°ê³¼ ì €ì¥ â†’ BigQuery monitoring.data_quality_checks       â”‚
â”‚  â‘¤ 30ë¶„ ì£¼ê¸° ìë™ ì‹¤í–‰ (Airflow DAG + K8s CronJob)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ì‹¤ì œ AI ë¶„ì„ ë¦¬í¬íŠ¸ ì˜ˆì‹œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¤– GenAI Quality Report       Gemini 2.0 Flash          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  â–  cdc_orders í…Œì´ë¸” ë³¼ë¥¨ ê²½ê³  (z-score: 1.89)           â”‚
â”‚                                                           â”‚
â”‚  ì£¼ë¬¸ëŸ‰ì´ 14ì¼ í‰ê·  ëŒ€ë¹„ ì•½ 32% ì¦ê°€í•œ ê²ƒìœ¼ë¡œ             â”‚
â”‚  ê´€ì¸¡ë©ë‹ˆë‹¤. í•´ë‹¹ ì‹œì ì˜ í”„ë¡œëª¨ì…˜ ì´ë²¤íŠ¸(ì„¤ ì—°íœ´ í• ì¸)ì—   â”‚
â”‚  ë”°ë¥¸ ì •ìƒì ì¸ íŠ¸ë˜í”½ ì¦ê°€ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.                   â”‚
â”‚                                                           â”‚
â”‚  ğŸ’¡ ê¶Œì¥ ì¡°ì¹˜:                                            â”‚
â”‚  1. í”„ë¡œëª¨ì…˜ ê¸°ê°„ volume threshold z-score 3.0 ìƒí–¥ ì¡°ì •  â”‚
â”‚  2. CDC Pipeline ë²„í¼ í¬ê¸° 100 â†’ 200 ì¦ì„¤                 â”‚
â”‚  3. BigQuery Streaming Insert quota ëª¨ë‹ˆí„°ë§ ê°•í™”          â”‚
â”‚                                                           â”‚
â”‚  ğŸ“Š ë¹„ì¦ˆë‹ˆìŠ¤ ì˜í–¥ë„:                                      â”‚
â”‚  í˜„ì¬ ë°ì´í„° ì§€ì—° ì—†ì´ ì •ìƒ ì²˜ë¦¬ ì¤‘.                       â”‚
â”‚  SLA ìœ„ë°˜ ê°€ëŠ¥ì„±: ë‚®ìŒ âœ…                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ ì „ëµ

```python
# temperature=0.1 â€” ì‚¬ì‹¤ ê¸°ë°˜ ë¶„ì„ì— ìµœì í™” (ì°½ì˜ì„± < ì •í™•ì„±)
self.llm = ChatGoogleGenerativeAI(
    model="gemini-2.0-flash",
    temperature=0.1,  # Low temperature for factual analysis
)

# System Prompt â€” "ì´ì»¤ë¨¸ìŠ¤ ì»¨í…ìŠ¤íŠ¸"ë¥¼ LLMì— ì£¼ì…
SystemMessage(content="""You are a Senior Data Engineer at an e-commerce company
similar to Kurly (Korean grocery delivery platform).
Your role is to analyze data quality issues and provide actionable insights.
...""")
```

### 3-2. SQL Optimizer â€” ì‹¤ì§ˆì  ROI ì°½ì¶œ

> **"BigQuery dry-runìœ¼ë¡œ ë¹„ìš©ì„ ì¶”ì •í•˜ê³ , LLMì´ ìµœì í™”í•˜ì—¬ 31% ë¹„ìš© ì ˆê°ì„ ë‹¬ì„±"**

```
Before Optimization               After Optimization
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SELECT *                     â†’    SELECT event_id, event_type,
FROM raw.user_events               user_id, event_timestamp
WHERE event_timestamp > ...        FROM raw.user_events
                                   WHERE DATE(event_timestamp)
                                     = '2026-02-11'  â† íŒŒí‹°ì…˜ í”„ë£¨ë‹
                                   
Scan: 12.4 GB ($0.062)       â†’    Scan: 1.8 GB ($0.009)
                                   ì ˆê°: 85% (ì´ ì¿¼ë¦¬ ê¸°ì¤€)
```

![Cost Optimization](docs/dashboards/screenshots/dashboard-cost-optimization.png)
*â–² SQL ìµœì í™” ë„ì… ì „/í›„ BigQuery ì¼ì¼ ë¹„ìš© ì¶”ì´ ($19.1 â†’ $12.4, 31% ê°ì¶•)*

**Geminiê°€ ì œì•ˆí•˜ëŠ” ìµœì í™” íŒ¨í„´:**
1. **íŒŒí‹°ì…˜ í”„ë£¨ë‹**: `WHERE DATE(event_timestamp) = ...` ì¶”ê°€ë¡œ ì „ì²´ í…Œì´ë¸” ìŠ¤ìº” ë°©ì§€
2. **ì»¬ëŸ¼ í”„ë£¨ë‹**: `SELECT *` â†’ í•„ìš” ì»¬ëŸ¼ë§Œ ì§€ì •
3. **APPROX_COUNT_DISTINCT**: ì •í™•ë„ 99%ë¡œ ë¹„ìš© 50% ì ˆê°
4. **Materialized View**: ë°˜ë³µ ì§‘ê³„ ì¿¼ë¦¬ë¥¼ ì‚¬ì „ ê³„ì‚°

### 3-3. Pipeline Doc Generator â€” ìë™í™”ëœ ë¬¸ì„œí™”

```
ì…ë ¥: src/pipelines/batch_pipeline.py (ì†ŒìŠ¤ ì½”ë“œ)
     â†“ AST ë¶„ì„ + Gemini 2.0 Flash
ì¶œë ¥:
  ğŸ“„ Pipeline Overview
  ğŸ“Š Data Lineage (Mermaid ë‹¤ì´ì–´ê·¸ë¨)
  ğŸ“‹ Schema Description (ì…/ì¶œë ¥ ìŠ¤í‚¤ë§ˆ)
  âš™ï¸ Configuration (í™˜ê²½ ë³€ìˆ˜)
  ğŸ”” SLA & Monitoring (ì§€ì—° ì„ê³„ê°’, ì•Œë¦¼)
  ğŸ”§ Troubleshooting Guide (FAQ)
```

**íš¨ê³¼**: ìƒˆ íŒ€ì› ì˜¨ë³´ë”© ì‹œ íŒŒì´í”„ë¼ì¸ ì´í•´ ì‹œê°„ **2ì¼ â†’ 2ì‹œê°„**ìœ¼ë¡œ ë‹¨ì¶• (ì˜ˆìƒ)

---

## ğŸ” 4. Observability & Reliability (SRE ì¸¡ë©´)

> **"ë§Œë“œëŠ” ê²ƒë³´ë‹¤ ìœ ì§€í•˜ëŠ” ê²ƒì´ ë” ì–´ë µë‹¤"ëŠ” ê²ƒì„ ì•„ëŠ” ê°œë°œìì„ì„ ì¦ëª…í•©ë‹ˆë‹¤.**

### Full-Stack ëª¨ë‹ˆí„°ë§ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Prometheus Stack                       â”‚
â”‚                                                          â”‚
â”‚  Event Collector â”€â”€â†’ /metrics â”€â”€â†’ Prometheus â”€â”€â†’ Grafana â”‚
â”‚  CDC Pipeline    â”€â”€â†’ :9090    â”€â”€â†’  (15d ë³´ê´€)  â”€â”€â†’ ğŸ“Š   â”‚
â”‚  Batch Pipeline  â”€â”€â†’ decorator â”€â”€â†’             â”€â”€â†’       â”‚
â”‚                                                          â”‚
â”‚  ServiceMonitor (ìë™ íƒ€ê²Ÿ ë°œê²¬)                          â”‚
â”‚  AlertManager â†’ Slack (#data-platform-critical)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì»¤ìŠ¤í…€ ë©”íŠ¸ë¦­ ì„¤ê³„ (20+ ë©”íŠ¸ë¦­)

| ì¹´í…Œê³ ë¦¬ | ë©”íŠ¸ë¦­ | ì„¤ëª… |
|:---------|:-------|:-----|
| **Pipeline** | `pipeline_runs_total` | íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ íšŸìˆ˜ (ì„±ê³µ/ì‹¤íŒ¨) |
| | `pipeline_duration_seconds` | ì‹¤í–‰ ì‹œê°„ íˆìŠ¤í† ê·¸ë¨ (P50/P95/P99) |
| | `pipeline_rows_processed_total` | ì²˜ë¦¬ëœ í–‰ ìˆ˜ |
| **Data Quality** | `data_freshness_minutes` | í…Œì´ë¸”ë³„ ë°ì´í„° ì‹ ì„ ë„ |
| | `data_quality_check_status` | í’ˆì§ˆ ì²´í¬ ìƒíƒœ (1=pass, 0=fail) |
| | `data_null_rate` | ì»¬ëŸ¼ë³„ null ë¹„ìœ¨ |
| | `data_volume_zscore` | ë³¼ë¥¨ ì´ìƒì¹˜ z-score |
| **BigQuery** | `bigquery_bytes_processed_total` | ìŠ¤ìº”ëœ ë°ì´í„°ì–‘ (ë¹„ìš© ì¶”ì ) |
| | `bigquery_query_duration_seconds` | ì¿¼ë¦¬ ì‹¤í–‰ ì‹œê°„ |
| **Pub/Sub** | `pubsub_messages_published_total` | ë°œí–‰ëœ ë©”ì‹œì§€ ìˆ˜ |
| | `pubsub_publish_latency_seconds` | í¼ë¸”ë¦¬ì‹œ ì§€ì—° ì‹œê°„ |
| **HTTP** | `events_received_total` | ìˆ˜ì‹ ëœ ì´ë²¤íŠ¸ ìˆ˜ (íƒ€ì…/ë””ë°”ì´ìŠ¤ë³„) |
| | `request_latency_seconds` | API ìš”ì²­ ì§€ì—° (P99 < 50ms ëª©í‘œ) |

### SLA ê¸°ë°˜ ì•Œë¦¼ ì²´ê³„

```yaml
# 4ë‹¨ê³„ ì‹¬ê°ë„ ë¶„ë¥˜
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”´ Critical (ì¦‰ì‹œ ëŒ€ì‘, 1h ë°˜ë³µ)                                    â”‚
â”‚     â€¢ EventCollectorHighErrorRate: ì—ëŸ¬ìœ¨ > 5% (5ë¶„ ì§€ì†)            â”‚
â”‚     â€¢ DataFreshnessSLABreach: ë°ì´í„° ì§€ì—° > 30ë¶„                     â”‚
â”‚                                                                       â”‚
â”‚  ğŸŸ¡ Warning (4h ë°˜ë³µ)                                                â”‚
â”‚     â€¢ PipelineExecutionFailed: íŒŒì´í”„ë¼ì¸ ì‹¤í–‰ ì‹¤íŒ¨                   â”‚
â”‚     â€¢ DataPlatformPodRestarting: Pod ì¬ì‹œì‘ > 3íšŒ/ì‹œê°„                â”‚
â”‚                                                                       â”‚
â”‚  ğŸ“¢ ì•Œë¦¼ ê²½ë¡œ                                                        â”‚
â”‚     Critical â†’ #data-platform-critical (Slack) â†’ PagerDuty           â”‚
â”‚     Warning  â†’ #data-platform-alerts (Slack)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê²½í—˜ ì‚¬ë¡€

#### Case 1: CDC Pipeline ë©”ëª¨ë¦¬ OOM

```
ì¦ìƒ: cdc-pipeline Podê°€ ì£¼ê¸°ì ìœ¼ë¡œ ì¬ì‹œì‘ (OOMKilled)
ì›ì¸: í”¼í¬ ì‹œê°„ëŒ€ CDC ì´ë²¤íŠ¸ ê¸‰ì¦ â†’ ë©”ëª¨ë¦¬ ë²„í¼ ì´ˆê³¼
ë¶„ì„: Prometheus ë©”íŠ¸ë¦­ì—ì„œ memory ì‚¬ìš©ëŸ‰ì´ limits(2Gi) ë„ë‹¬ í™•ì¸
í•´ê²°:
  1. CDC_BATCH_SIZE 100 â†’ 50 ì¶•ì†Œ (ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì†Œ)
  2. CDC_FLUSH_INTERVAL_SEC 5 â†’ 3ì´ˆë¡œ ë‹¨ì¶• (ë” ìì£¼ flush)
  3. memory limits 2Gi â†’ 3Gië¡œ ìƒí–¥ (ë²„í¼ ì—¬ìœ  í™•ë³´)
ê²°ê³¼: Pod ì¬ì‹œì‘ 0íšŒ/ì¼ ë‹¬ì„±
```

#### Case 2: BigQuery ë¹„ìš© ìŠ¤íŒŒì´í¬

```
ì¦ìƒ: ì¼ì¼ BigQuery ë¹„ìš©ì´ $18 â†’ $42ë¡œ ê¸‰ì¦
ì›ì¸: ìƒˆ ë¶„ì„ ì¿¼ë¦¬ì—ì„œ íŒŒí‹°ì…˜ í•„í„° ì—†ì´ ì „ì²´ í…Œì´ë¸” ìŠ¤ìº”
ë¶„ì„: bigquery_bytes_processed_total ë©”íŠ¸ë¦­ì—ì„œ ì´ìƒì¹˜ íƒì§€
í•´ê²°:
  1. SQL Optimizerë¡œ í•´ë‹¹ ì¿¼ë¦¬ ë¶„ì„ â†’ íŒŒí‹°ì…˜ í”„ë£¨ë‹ ì ìš©
  2. BigQuery ì¡°ì§ ì •ì±…ì— ìµœëŒ€ ìŠ¤ìº” ë°”ì´íŠ¸ ì œí•œ ì„¤ì •
  3. ë¹„ìš© ì•Œë¦¼ ì„ê³„ê°’ ì¶”ê°€ ($25/day â†’ Warning)
ê²°ê³¼: ë¹„ìš© $42 â†’ $12.4ë¡œ ì •ìƒí™”
```

---

## âš™ï¸ ê¸°ìˆ  ìŠ¤íƒ ìš”ì•½

```
Language        Python 3.11+ (Type Hints, async/await, dataclasses)
API             FastAPI (ë¹„ë™ê¸°, Pydantic ê²€ì¦, Prometheus ë‚´ì¥)
Data Warehouse  Google BigQuery (Partitioning, Clustering, Streaming Insert)
Stream          Google Cloud Pub/Sub + Apache Beam (Dataflow)
CDC             Debezium (pgoutput) â†’ Kafka â†’ Custom Pipeline
Orchestration   Apache Airflow (KubernetesExecutor)
Infrastructure  GKE (Private Cluster, HPA, Spot Instance) + Terraform
GenAI           Gemini 2.0 Flash + LangChain (Quality Agent, SQL Optimizer)
Observability   Prometheus + Grafana + OpenTelemetry + Structured Logging
CI/CD           Docker (Multi-stage) + Makefile + Helm
Testing         pytest + pytest-asyncio (Unit, Integration)
```

---

## ğŸš€ Getting Started

### Prerequisites
- Python 3.11+
- Docker & Docker Compose
- Google Cloud SDK (`gcloud`)
- Terraform >= 1.9
- kubectl

### ë¡œì»¬ ê°œë°œ í™˜ê²½

```bash
# 1. í”„ë¡œì íŠ¸ í´ë¡  & í™˜ê²½ ì„¤ì •
git clone https://github.com/your-org/ecommerce-data-platform.git
cd ecommerce-data-platform
pip install -e ".[dev]"

# 2. ë¡œì»¬ ì¸í”„ë¼ ì‹¤í–‰ (PostgreSQL + BigQuery Emulator + Grafana)
make dev

# 3. í…ŒìŠ¤íŠ¸ ì´ë²¤íŠ¸ ìƒì„± & í…ŒìŠ¤íŠ¸ ì‹¤í–‰
make generate-events
make test
```

### GCP ë°°í¬

```bash
# 1. Terraformìœ¼ë¡œ ì¸í”„ë¼ í”„ë¡œë¹„ì €ë‹
make tf-init && make tf-plan && make tf-apply

# 2. GKE ì ‘ì† & K8s ë°°í¬
gcloud container clusters get-credentials data-platform-dev \
  --zone asia-northeast3-a --project YOUR_PROJECT_ID
make k8s-deploy

# 3. ìƒíƒœ í™•ì¸
make k8s-status
```

---

## ğŸ§ª Testing

```bash
# ì „ì²´ í…ŒìŠ¤íŠ¸
make test

# ëª¨ë“ˆë³„ í…ŒìŠ¤íŠ¸
pytest tests/test_event_collector.py -v   # Event Collector API
pytest tests/test_pipelines.py -v         # íŒŒì´í”„ë¼ì¸ ë¡œì§
pytest tests/test_genai.py -v             # GenAI ì—ì´ì „íŠ¸

# ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸
pytest --cov=src --cov-report=html
```

---

## ğŸ“ í”„ë¡œì íŠ¸ë¥¼ í†µí•´ ë°°ìš´ ê²ƒ

1. **BigQuery ë¹„ìš© = ì„¤ê³„ ë¹„ìš©**: íŒŒí‹°ì…”ë‹/í´ëŸ¬ìŠ¤í„°ë§ ì „ëµ ì—†ì´ëŠ” ë¹„ìš©ì´ ê¸°í•˜ê¸‰ìˆ˜ì ìœ¼ë¡œ ì¦ê°€í•©ë‹ˆë‹¤. "ì‚¬ì „ ì„¤ê³„"ê°€ ê³§ ë¹„ìš© ìµœì í™”ì…ë‹ˆë‹¤.

2. **KubernetesëŠ” "ìš´ì˜ì˜ ë³µì¡ì„±"ì„ ë‹¤ë£¨ëŠ” ë„êµ¬**: K8s ìì²´ê°€ ëª©ì ì´ ì•„ë‹ˆë¼, HPA/PDB/Graceful Shutdown ê°™ì€ íŒ¨í„´ì„ í†µí•´ "ì„œë¹„ìŠ¤ ì•ˆì •ì„±"ì„ í™•ë³´í•˜ëŠ” ìˆ˜ë‹¨ì…ë‹ˆë‹¤.

3. **GenAIëŠ” "ë°˜ë³µ ì—…ë¬´ì˜ ìë™í™”"ì—ì„œ ì§„ê°€ë¥¼ ë°œíœ˜**: ë°ì´í„° í’ˆì§ˆ ì²´í¬, SQL ìµœì í™”, ë¬¸ì„œí™”ì²˜ëŸ¼ ë°˜ë³µì ì´ì§€ë§Œ ì „ë¬¸ì„±ì´ í•„ìš”í•œ ì˜ì—­ì—ì„œ AIê°€ ì‹¤ì§ˆì  ROIë¥¼ ë§Œë“­ë‹ˆë‹¤.

4. **ObservabilityëŠ” "ì‚¬í›„ ëŒ€ì‘"ì´ ì•„ë‹Œ "ì‚¬ì „ ì˜ˆë°©"**: ë©”íŠ¸ë¦­ì„ ì˜ ì„¤ê³„í•˜ë©´ ì¥ì• ê°€ ë°œìƒí•˜ê¸° ì „ì— ì´ìƒ ì§•í›„ë¥¼ í¬ì°©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

<p align="center">
  <sub>Built with â˜• and GenAI assistance (GitHub Copilot + Claude + Gemini)</sub>
</p>
